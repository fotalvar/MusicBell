<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="Sistema autom√°tico de reproducci√≥n de m√∫sica para escuelas">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MusicBell">
    
    <title>MusicBell - Control de M√∫sica Escolar</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="/images/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/images/icon-512.png">
    <link rel="apple-touch-icon" href="/images/icon-192.png">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- NAVBAR PRINCIPAL -->
        <nav class="navbar">
            <div class="navbar-left">
                <svg class="navbar-logo" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z" />
                </svg>
                <h1 class="navbar-title">MusicBell</h1>
            </div>

            <div class="navbar-center">
                <button class="nav-option" data-tab="canciones" onclick="cambiarTab('canciones')">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h12v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z" />
                    </svg>
                    Playlist
                </button>
                <button class="nav-option" data-tab="reproduccion" onclick="cambiarTab('reproduccion')">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z" />
                    </svg>
                    Reproducci√≥n
                </button>
            </div>

            <div class="navbar-right">
                <!-- REPRODUCTOR MINIMALISTA -->
                <div class="player-widget">
                    <div id="playerContent" class="player-content">
                        <div class="player-info">
                            <p id="playerStatus">Pr√≥xima canci√≥n programada: Ninguna</p>
                        </div>
                    </div>
                </div>

                <!-- BOT√ìN DE ESTADO/RED -->
                <button id="btnEstado" class="btn-estado" onclick="toggleEstadoPanel()" title="Ver estado de red">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z" />
                    </svg>
                </button>

                <button id="btnApagar" class="btn-shutdown" onclick="apagarAplicacion()">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-13c-2.76 0-5 2.24-5 5h2c0-1.66 1.34-3 3-3s3 1.34 3 3H17c0-2.76-2.24-5-5-5z" />
                    </svg>
                    Apagar
                </button>
            </div>
        </nav>

        <!-- SUBBARRA DE ACCIONES -->
        <div class="subbarra">
            <div id="subbarraAcciones" class="subbarra-content"></div>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <main class="main-content">
            <div id="tab-canciones" class="tab-pane activo">
                <div id="playlistContainer" class="playlist-container">
                    <p>Cargando playlist...</p>
                </div>
            </div>
            <div id="tab-reproduccion" class="tab-pane">
                <div id="reproduccionContainer" class="reproduccion-container">
                    <p>Cargando canciones disponibles...</p>
                </div>
            </div>
        </main>

        <!-- PANEL FLOTANTE DE ESTADO/RED -->
        <div id="panelEstado" class="panel-estado">
            <div class="panel-header">
                <h3>Estado de Red</h3>
                <button class="btn-minimize" onclick="cerrarEstadoPanel()">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
            </div>
            <div class="panel-content">
                <div class="estado-item">
                    <span class="estado-label">IP Local:</span>
                    <span id="estadoIP" class="estado-value">Conectando...</span>
                </div>
                <div class="estado-item">
                    <span class="estado-label">Puerto:</span>
                    <span id="estadoPuerto" class="estado-value">-</span>
                </div>
                <div class="estado-item">
                    <span class="estado-label">Acceso Remoto:</span>
                    <span id="estadoRemoto" class="estado-value">-</span>
                </div>
                <button class="btn-copy-remote" onclick="copiarDatosRemoto()"
                    style="margin-top: 10px; width: 100%;">Copiar datos remoto</button>
            </div>
        </div>
    </div>

    <!-- MODALES -->
    <div id="modalAgregarCancion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>A√±adir Nueva Canci√≥n</h3>
                <button class="modal-close" onclick="cerrarModalAgregarCancion()">&times;</button>
            </div>
            <form id="formularioCancion">
                <div class="form-group"><label for="nombre">Nombre:</label><input type="text" id="nombre" required>
                </div>
                <div class="form-group"><label for="archivo">Archivo MP3:</label><select id="archivo" required>
                        <option value="">-- Selecciona un archivo --</option>
                    </select></div>
                <div class="form-group"><label for="tipo">Tipo de Planificaci√≥n:</label><select id="tipo" required
                        onchange="cambiarTipo()">
                        <option value="hora">Hora diaria</option>
                        <option value="fecha">Fecha espec√≠fica</option>
                        <option value="dia_semana">D√≠as de la semana</option>
                    </select></div>
                <div class="form-group"><label for="hora">Hora:</label><input type="time" id="hora" required></div>
                <div class="form-group" id="grupoFecha" style="display:none;"><label for="fecha">Fecha:</label><input
                        type="date" id="fecha"></div>
                <div class="form-group" id="grupoDias" style="display:none;"><label>D√≠as de la semana:</label>
                    <div class="dias-checkbox"><label><input type="checkbox" name="dia" value="lunes">
                            Lunes</label><label><input type="checkbox" name="dia" value="martes">
                            Martes</label><label><input type="checkbox" name="dia" value="mi√©rcoles">
                            Mi√©rcoles</label><label><input type="checkbox" name="dia" value="jueves">
                            Jueves</label><label><input type="checkbox" name="dia" value="viernes">
                            Viernes</label><label><input type="checkbox" name="dia" value="s√°bado">
                            S√°bado</label><label><input type="checkbox" name="dia" value="domingo"> Domingo</label>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;"><button type="submit" class="btn-guardar"
                        style="flex: 1;">Agregar Canci√≥n</button><button type="button" class="btn-cancelar"
                        onclick="cerrarModalAgregarCancion()" style="flex: 1;">Cancelar</button></div>
            </form>
        </div>
    </div>

    <div id="modalProgramacionRapida" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M13 3h-2v10h2V3zm4.83 2.17l-1.41 1.41C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z" />
                    </svg>Programaci√≥n R√°pida</h3>
                <button class="modal-close" onclick="cerrarModalProgramacion()">&times;</button>
            </div>
            <form id="formularioProgramacionRapida">
                <div class="form-group"><label for="archivoProgramacion">Archivos MP3 (Selecciona
                        m√∫ltiples):</label><select id="archivoProgramacion" required multiple
                        onchange="actualizarResumenProgramacion()" style="min-height: 100px;">
                        <option value="">-- Selecciona uno o m√°s archivos --</option>
                    </select>
                    <small style="display: block; margin-top: 5px; color: #666; font-size: 0.85em;">üí° Usa Ctrl+Click
                        (Cmd+Click en Mac) para seleccionar m√∫ltiples</small>
                </div>
                <div class="form-group"><label for="fechaInicio">Fecha de Inicio:</label><input type="date"
                        id="fechaInicio" required></div>
                <div class="form-group"><label for="fechaFin">Fecha de Fin:</label><input type="date" id="fechaFin"
                        required></div>
                <div class="form-group"><label for="horaRapida">Hora de Reproducci√≥n:</label><input type="time"
                        id="horaRapida" required></div>
                <div class="form-group"><label><input type="checkbox" id="incluirFinSemana"
                            onchange="actualizarResumenProgramacion()"> Incluir fines de
                        semana</label></div>
                <div
                    style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid var(--primary);">
                    <p style="margin: 0 0 10px 0; font-weight: bold; font-size: 0.95em;">üìä Resumen:</p>
                    <p id="resumenProgramacion" style="margin: 0; color: #666; font-size: 0.9em;">Selecciona fechas y
                        archivo para ver el resumen</p>
                </div>
                <div style="display: flex; gap: 10px;"><button type="submit" class="btn-guardar"
                        style="flex: 1;">Generar Programaci√≥n</button><button type="button" class="btn-cancelar"
                        onclick="cerrarModalProgramacion()" style="flex: 1;">Cancelar</button></div>
            </form>
        </div>
    </div>

    <div id="modalCargaRemota" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>Cargar Archivo de M√∫sica</h3>
                <button class="modal-close" onclick="cerrarModalCargaRemota()">&times;</button>
            </div>
            <div class="upload-area" id="uploadArea" ondrop="handleDrop(event)" ondragover="handleDragOver(event)"
                ondragleave="handleDragLeave(event)">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                </svg>
                <p>Arrastra archivos aqu√≠ o haz clic para seleccionar</p>
                <input type="file" id="fileInput" accept=".mp3" multiple style="display: none;"
                    onchange="handleFileSelect(event)">
            </div>
            <div id="uploadProgress" style="display: none; margin-top: 20px;">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <p id="uploadStatus" style="text-align: center; margin-top: 10px; font-size: 0.9em;">Subiendo...</p>
            </div>
            <button class="btn-cancelar" onclick="cerrarModalCargaRemota()"
                style="width: 100%; margin-top: 15px;">Cerrar</button>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- Service Worker Registration para PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js').then(reg => {
                    console.log('‚úÖ Service Worker registrado:', reg);
                }).catch(err => {
                    console.log('‚ùå Error registrando Service Worker:', err);
                });
            });
        }
        
        // Detectar cuando la app puede ser instalada
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('üì≤ App lista para instalar');
            // Mostrar bot√≥n de instalaci√≥n si quieres
            // mostrarBotonInstalar();
        });
        
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ Aplicaci√≥n instalada');
            deferredPrompt = null;
        });
    </script>
</body>

</html>
